# 教授との面談メモ

## 概要

- 日時：2025年5月28日 13:10-
- 内容：val_loss記録と重み付き複合モデル構築（v2/v3）に関する進捗報告、およびパラメータレンジ学習に関する新たな提案

---

## 主なトピック

### 1. 単体モデル (`image2param_single.ipynb`) の構築と val_loss の記録

- 各パラメータに対して個別に学習を行い、`val_loss` を `val_losses.json` に記録する構成を実装。
- 学習回数は `REPEAT` により制御可能（例：1回 or 10回など）。
- 実行結果は以下のようにパラメータごとに配列で保存：
  ```json
  {
    "dipCount": [0.203, 0.187],
    "hue_cos": [0.110, 0.097],
    ...
  }
  ```
- JSON形式を採用した理由は：
  - 各パラメータをキーで管理しやすい
  - 配列で履歴を保持できる
  - 平均など統計処理がしやすい

### 2. 複合モデル v2 / v3 の実装と違い

#### `image2params_v2.ipynb`

- 単体モデルの val_loss を使用して、出力4次元（dipCount, hue_cos, hue_sin, circleCount）を同時回帰する CNN を構築。
- `val_losses.json` の **最新値** のみを参照し、逆数＋最大値正規化で `loss_weights` を作成。
- `WeightedMSELoss` によりスケール差を吸収したマルチタスク学習を実現。

#### `image2params_v3.ipynb`

- v2を拡張し、`VAL_LOSS_MODE` によって重み決定方法を切り替え可能に。
  - `"latest"`：val_lossの最新値を使用
  - `"average"`：val_lossの履歴平均を使用
- モードに応じて `loss_weights` を切り替え、より柔軟な学習構成に。
- 正規化済みの `dipCount`, `circleCount` はZ-score逆変換、`hue` は `(cos, sin) → arctan2` により角度復元。
- 可視化では、予測結果と真値を画像上に数値で表示し、予測精度の確認が容易。

### 3. パラメータレンジに基づく画像群の学習提案（Thema v2）

- 現在の学習構成は「画像とパラメータの1対1関係」を前提としているが、創作の実感としては「ある程度のレンジが生み出す作品群」が魅力を持つことが多い。
- そこで、**レンジ → 複数画像 → 評価** という単位で学習させる流れを検討。

#### 提案フロー（初期イメージ）

- パラメータのレンジ（例：dipCount ∈ [3, 5]）を指定
- その範囲から複数の画像をランダムに生成
- ユーザがその画像群をまとめて評価（例：良い / 微妙）
- そのデータを用いて「良い画像群を生むレンジの特徴」を学習

#### 意義と可能性

- 単体画像に対する予測よりも、より抽象的・構造的な好みに迫ることが可能
- 「画像群のまとまり感」に注目した研究として、ジェネラティブアートの実感とより近い学習フレームを模索できる

---

## 議論内容（ディスカッションログ）2025年5月28日

### 1. ロスと学習精度に関する話題

- val_lossに関しては、**逆数ベースの重み付け**で概ね妥当そうという認識で一致。
- 現状の結果を見ると、`circleCount` の精度がかなり悪く、重み補正の観点からも特に注視が必要。
- `wandb`にCSVを入れて記録・可視化することで、進捗のトラッキングがしやすくなりそう。
- 全体的に**コード検証の精度と信頼性が甘い**という指摘があり、見直しが必要。

---

### 2. 単純な生成・再構成ループの提案

- 今後、次のような「生成→推定→再生成→比較」のループ構築を試したい：
  1. パラメータから画像を生成
  2. 識別器で画像からパラメータを推定
  3. 推定パラメータで画像を再生成
  4. 元画像と再生成画像を比較（見た目や数値）

- これにより、**学習済みモデルの再現性・頑健性の評価**が可能になる見込み。

---

### 3. パラメータレンジと画像群の扱い

- 当初は「**レンジを指定して画像群を生成・学習する**」方向も検討していたが、議論を経て再整理。
- 結論としては、「画像群を学習する」わけではなく、**画像を個別に学習した結果として、パラメータと好みに基づくクラスタが形成され、その中に画像群が“なる”**という流れ。
- つまり、**広いパラメータレンジで画像を網羅的に生成・学習し、あとから構造（画像群）を見つける**というアプローチにシフトした。
- 混合正規分布のような「背後にある分布を仮定する」視点も、生成器設計時に活用できそう。

---

### 4. 見やすさ・評価の取り扱い

- 視認性や「見やすさ」を5段階スコアで評価するのは本質的でないという課題意識。
- 代替案として、**時間評価**や**探索的な選択操作**で間接的に評価できないか模索中。
- 主観評価に代わる方法として：
  - 候補画像を並べてどれが好みか選ぶ（相対評価）
  - ランキングの組み合わせ（好みは線形ではない）

---

### 5. 好みに基づく進化的最適化の可能性

- 遺伝的アルゴリズムや探索的最適化を用いて、「選ばれる好み」に収束するようなアプローチが考えられる。
- 相対評価ベースのアルゴリズムが有効で、**ユーザの選択傾向に合わせて最適化を進める設計**が望ましい。
- ラベルの付け方次第では、クラスタリングによる構造整理との併用も可能。

---

### 6. 識別器とクラスタリングの接続

- 識別器の性能評価方法が未定だが、**識別された好みのパターンから自然に画像群が浮かび上がる可能性**に注目。
- これは明示的に画像群を学習しなくても、「結果的に画像群が“なる”」という見立て。
- クラスタリングやembedding空間上の可視化が次の一手になるかも。

---

### 7. 実装・画像生成の手段

- 画像生成自体は、p5.jsによる既存の構造で問題なさそう。
- GANやオートエンコーダーで画像自体を生成する必要性は薄いと判断。
- むしろ、**出力すべきはパラメータであり、画像はp5.jsで再現可能**という見通しで進行中。

---

### 8. 今後の展望と派生的応用

- 好みに基づいた評価を他の画像タイプにも適用できるか、一般化の方向性が見えてきた。
- 例えば「この作品が好きなら、こういう別ジャンルも好きかも」といった**好みの転移学習**が可能か？
- styleGANなどの外部生成器にフィードバックを与える応用可能性も示唆される。
- 評価スコアをそのまま使わず、**間隔の非対称性**を考慮する工夫も必要。