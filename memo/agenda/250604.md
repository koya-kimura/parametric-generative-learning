# 教授との面談メモ

## 概要

- 日時：2025年6月4日
- 内容：CNNによるランキング予測の実装・評価結果の可視化と課題点、今後の改善方針について共有

---

## 主なトピック

### 1. ランキング予測モデルの評価用コードの実装

- 学習済みモデルの検証を目的に、以下を実装：
  - `predict_ranks()`：valデータに対するスコア予測
  - `assign_rank()`：`.argsort().argsort()` による順位算出関数
  - 実際の順位と予測順位を比較するためのMAE、相関係数（Spearman, Kendall）計算
- `tensor.item()` による0次元テンソルの明示的変換が必要だった

### 2. データセットの視覚確認と検証用可視化コードの追加

- `train` および `val` に分けたデータから、画像・パラメータ・順位の関係性を視覚化
- p5.jsで生成した画像と、ランキング情報（実値および予測）の表示を並列に確認可能に
- matplotlibでの棒グラフ表示も追加し、**視覚的にズレの傾向を把握**できるようにした

### 3. 初期のモデル評価結果とその限界

- 実験により、**予測された順位と実際の順位にほとんど相関がない**ことが可視化で判明
- Spearman相関・Kendall相関・MAEなどの指標を用いて定量評価しても非常に低かった
- 散布図では相関が把握しにくいため、棒グラフ形式で比較表示した

---

## 議論内容（ディスカッションログ）2025年6月4日

### 1. コード整備とエラー対応

- `IndexError: too many indices for array` → `.item()` を使用して解決
- 予測出力を `.squeeze().numpy()` によって整形し、スカラー化
- `assign_rank()` の `.argsort().argsort()` は numpyベースで正しく動作
- `matplotlib` によるグラフ描画コードを追加し、直感的に順位誤差を可視化

### 2. 可視化・評価コードの改良

- `val_df` に対して画像・実順位・予測順位をセットで描画する関数を設計
- 左から順に：
  - 元画像
  - 実際の順位（rank）
  - 予測順位（pred_rank）
- 並列的に50枚ほど一気に表示可能な構成に調整

### 3. 今後の改善方針

- 現在の回帰→スコア→順位変換という構成では精度が出にくいと判断
- **ペアワイズ損失やランキング学習専用の損失関数**（例：ListNet, RankNet）の導入検討
- モデル構造の改善・データの質・正規化処理の見直しも視野に入れる
- `pairwise-comparator` のようなアーキテクチャを試してみる方針もあり

---

## 議論メモ：2025年6月4日

### 概要

CNNによるランキング予測の精度が出なかったことを受けて、**ランキング構造の再考**と**擬似評価関数による実験プロトタイプ**について議論を実施。

---

### 1. ランキングの構造と戦略

- 現在の「1を足すスコア化」方式はある程度妥当ではある
- **トーナメント形式**でのランキング構築が有効かもしれない
  - 勝者／敗者トーナメントの両構成を利用
  - 「誰に負けたか」がスコアに影響する構成もアリ（例：優勝者に負けたら減点が少ない）
  - 2のべき乗個のデータだと処理が整理しやすい
- 差を上手につけるアルゴリズム（ペア選定の工夫）も重要

---

### 2. 擬似評価関数によるスコア生成の提案

- 擬似的な好みモデル（評価関数）を作ることで、データ生成と学習を行えるのでは？
  - 「特定の特徴を持つものが好きで、その周辺も好き」という仮定（＝**混合分布モデル**）
  - 例：2つの基準点との距離で好みを表現し、近い方のスコアを用いる
  - 相似性を評価する単純なルールの導入でも実験は可能
- 流れとして：
  1. パラメータ空間から大量にサンプルを生成
  2. 擬似関数によりスコア（または順位）を割り当てる
  3. それに対応する画像を生成
  4. モデルがそのスコア／ランキングを学習できるかを検証

---

### 3. 実験設計における補足案

- 単純な構成（例：中央の円の色のみ）でプロトタイプをまず試すと良い
- 画像に対する**ランキングの再現**はスコア予測より難しい
  - ランキングには「差の大きさ」が含まれないため、学習が不安定
  - 本質的には**順序とスケールが混在するタスク**
- **スコア回帰に一旦フォーカス**し、その後にランキング評価を再考するのが良さそう

---

### 4. その他の検討事項

- ちゃんとやるならスコア分布は**正規分布 or 混合正規分布**が前提になる
- 決定木ベースの手法も確認しておくとよい（ライブラリも存在）
- ランキング予測は一旦中止し、**スコア予測を主軸にシフト**

---