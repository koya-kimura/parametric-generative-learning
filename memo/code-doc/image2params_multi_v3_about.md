# ðŸ“š ãƒŽãƒ¼ãƒˆãƒ–ãƒƒã‚¯å…¨ä½“æ§‹æˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼ˆãƒ‘ãƒ©ãƒ¡ãƒˆãƒªãƒƒã‚¯ç”»åƒå­¦ç¿’ç·¨ï¼‰

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€p5.jsã§ç”Ÿæˆã•ã‚ŒãŸã‚¸ã‚§ãƒãƒ©ãƒ†ã‚£ãƒ–ç”»åƒã‹ã‚‰  
è¤‡æ•°ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆå½¢çŠ¶ãƒ»è‰²ç›¸ãªã©ï¼‰ã‚’äºˆæ¸¬ã™ã‚‹CNNã‚’å­¦ç¿’ã—ã¾ã™ã€‚

ãƒ¢ãƒ‡ãƒ«ã®ãƒ­ã‚¹é–¢æ•°ã«ã¯ã€**å˜ä½“ãƒ¢ãƒ‡ãƒ«ã«ã‚ˆã£ã¦åŽé›†ã•ã‚ŒãŸ val_loss ã®å±¥æ­´**ã‚’æ´»ç”¨ã—ã€  
å„å‡ºåŠ›ã«é©åˆ‡ãªé‡ã¿ã‚’å‰²ã‚Šå½“ã¦ã‚‹ã“ã¨ã§ã€å¤šã‚¿ã‚¹ã‚¯å­¦ç¿’ã®æœ€é©åŒ–ã‚’å›³ã‚Šã¾ã™ã€‚

---

## ðŸŽ¯ `image2param_single.ipynb`ï¼šå˜ä½“ãƒ¢ãƒ‡ãƒ«ã«ã‚ˆã‚‹ val_loss è¨˜éŒ²

### ðŸ“Œ ç›®çš„
- å„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆdipCount, hue_cos, hue_sin, circleCountï¼‰ã«å¯¾ã—ã¦å€‹åˆ¥ã«å­¦ç¿’ã‚’å®Ÿè¡Œã—ã€
  **æ¤œè¨¼ãƒ­ã‚¹ (val_loss)** ã‚’ `val_losses.json` ã«è¿½è¨˜è¨˜éŒ²ã™ã‚‹

### ðŸ“ å‡ºåŠ›
- `loss_stats/val_losses.json`ï¼š
  - å„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã® val_loss ã‚’é…åˆ—å½¢å¼ã§è“„ç©
  - ä¾‹ï¼š
    ```json
    {
      "dipCount": [0.203, 0.187],
      "hue_cos": [0.110, 0.097],
      ...
    }
    ```

### ðŸ” å®Ÿè¡Œåˆ¶å¾¡
- å„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«å¯¾ã—ã¦ `REPEAT` å›žæ•°ã ã‘å­¦ç¿’ã‚’è¡Œã†ï¼ˆä¾‹ï¼šREPEAT=10ï¼‰

### ðŸ§© ä¸»ãªæ§‹æˆã‚¹ãƒ†ãƒƒãƒ—
1. åˆæœŸè¨­å®šï¼ˆREPEAT/ãƒ‘ã‚¹è¨­å®š/val_losses.json èª­ã¿è¾¼ã¿ï¼‰
2. CSVèª­ã¿è¾¼ã¿ãƒ»å¯¾è±¡æŠ½å‡º
3. Datasetå®šç¾©ï¼ˆtarget_colã‚’æŒ‡å®šï¼‰
4. train/valåˆ†å‰²ã¨DataLoaderä½œæˆ
5. å˜ä½“CNNã§ã®å­¦ç¿’ + val_lossæ¸¬å®šï¼ˆREPEATåˆ†ï¼‰
6. val_losses.jsonã¸ã®è¿½è¨˜ä¿å­˜
7. çµ±è¨ˆã®ç¢ºèªãƒ»å¯è¦–åŒ–ï¼ˆå¹³å‡ãƒ»åˆ†æ•£ãƒ»ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ï¼‰

---

## ðŸ§  `image2params_v3.ipynb`ï¼šé‡ã¿ä»˜ããƒžãƒ«ãƒã‚¿ã‚¹ã‚¯å­¦ç¿’

### ðŸ“Œ ç›®çš„
- `val_losses.json` ã‚’å‚ç…§ã—ã€å‡ºåŠ›ã”ã¨ã® val_loss ã«å¿œã˜ãŸé‡ã¿ã‚’å°Žå‡º
- 4å‡ºåŠ›ï¼ˆdipCount, hue_cos, hue_sin, circleCountï¼‰åŒæ™‚å›žå¸°ãƒ¢ãƒ‡ãƒ«ã‚’å­¦ç¿’

### âš™ï¸ é‡ã¿ãƒ¢ãƒ¼ãƒ‰
- `VAL_LOSS_MODE` ã§åˆ‡ã‚Šæ›¿ãˆå¯èƒ½ï¼š
  - `"latest"`ï¼šæœ€æ–°ã®1ã¤ã‚’ä½¿ã†
  - `"average"`ï¼šå±¥æ­´ã®å¹³å‡ã‚’ä½¿ã†

### ðŸŽ¯ æå¤±é–¢æ•°
- `WeightedMSELoss`:  
  å„å‡ºåŠ›ã«é‡ã¿ã‚’ã‹ã‘ãŸ MSE ã‚’è¨ˆç®—
  ```python
  loss = mean(weights * (y_pred - y_true)^2)
  ```

### ðŸ§© ä¸»ãªæ§‹æˆã‚¹ãƒ†ãƒƒãƒ—
1. åˆæœŸè¨­å®šï¼ˆloss_weightsè¨ˆç®— + ãƒ‡ãƒã‚¤ã‚¹ï¼‰
2. metadata.csv + Z-score æ­£è¦åŒ– + ä¿å­˜
3. Datasetå®šç¾©ï¼ˆhueâ†’cos/sinå¤‰æ›å«ã‚€ï¼‰
4. train/val åˆ†å‰²ãƒ»DataLoaderæ§‹ç¯‰
5. CNNãƒ¢ãƒ‡ãƒ«å®šç¾©ï¼ˆå‡ºåŠ›4ãƒ¦ãƒ‹ãƒƒãƒˆï¼‰
6. å­¦ç¿’ãƒ«ãƒ¼ãƒ—ï¼ˆWeightedMSE + wandbãƒ­ã‚°ï¼‰
7. æŽ¨è«–ï¼‹é€†æ­£è¦åŒ–ï¼‹ç”»åƒä¸Šã«æ•°å€¤è¡¨ç¤º
8. Lossã‚«ãƒ¼ãƒ–æç”»ï¼ˆtrain / valï¼‰

---

## ðŸ”„ ãƒ•ã‚¡ã‚¤ãƒ«é€£æºã®æµã‚Œ

```
image2param_single.ipynb â”€â”¬â”€> val_losses.json ï¼ˆè¨˜éŒ²ï¼‰
                          â”‚
image2params_v3.ipynb <â”€â”€â”€â”˜ ï¼ˆå‚ç…§ + é‡ã¿ã«å¤‰æ›ï¼‰
```

---

## ðŸ”§ ä»Šå¾Œã®æ‹¡å¼µæ¡ˆ

- ãƒ­ã‚¹ã”ã¨ã®å€‹åˆ¥ãƒ­ã‚°ï¼ˆdipã ã‘ã® loss ã‚’ wandb ã«è¨˜éŒ²ï¼‰
- è©•ä¾¡æŒ‡æ¨™ã®ç´°åˆ†åŒ–ï¼ˆè§’åº¦èª¤å·®ã€MAEãªã©ï¼‰
- ãƒ¢ãƒ‡ãƒ«å‡ºåŠ›ã®é¸æŠžï¼ˆæ¡ä»¶ä»˜ãç”Ÿæˆã¸ã®æŽ¥ç¶šï¼‰